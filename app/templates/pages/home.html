{% extends 'base.html' %}
{% block content %}
<div class="row">

  <div class="col-12 col-lg-6 d-flex align-items-stretch">
    <div class="card next-dates">
      <div class="card-header">Geplante Termine</div>
      <div class="card-body">
        <div class="row">

          <div class="col-4">
            <div class="datetime">
              <div class="time">{{ uhrzeit }}</div>
              <div class="date">{{ tag }}</div>
              <div class="next-date-slogan">
                NÃ¤chster Termin
              </div>
              <div class="next-date-value">
                {{ termin_daten_list[0]['starttime'] }}
              </div>
            </div>
          </div>
          <div class="col-8">
            {% for item in termin_daten_list %}
              <div class="date_box">
                <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['weekday'] }}, {{
                  termin_daten[item]['date'] }} {{ termin_daten[item]['starttime'] }}-{{ termin_daten[item]['endtime'] }}
                </td>
                <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['machines'] }}</td>
                <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['employees'] }}</td>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6 align-items-stretch">
    <div class="card">
      <div class="card-header">Wettervorhersage</div>
      <div class="card-body">
        <div class="col-12 col-lg-3 d-flex flex-row align-items-center" style="height: 110px;">
          <div class="p-3">
            <h4>{{ informations['Temp'][0] }}&deg;</h4>
            {% if 200 <= informations['Wettercode'][0] < 300 %} <img
              src="{{ url_for('static', filename='img/weather/storm.svg') }}">
            {% elif 300 <= informations['Wettercode'][0] < 400 %} <img
              src="{{ url_for('static', filename='img/weather/rainy.svg') }}">
            {% elif informations['Wettercode'][0] == 500 %}
              <img src="{{ url_for('static', filename='img/weather/light_rain.svg') }}">
            {% elif 501 <= informations['Wettercode'][0] < 600 %} <img
              src="{{ url_for('static', filename='img/weather/rainy.svg') }}">
            {% elif informations['Wettercode'][0] == 616 %}
              <img src="{{ url_for('static', filename='img/weather/snow_and_rain.svg') }}">
            {% elif 600 <= informations['Wettercode'][0] < 700 %} <img
              src="{{ url_for('static', filename='img/weather/snowflake.svg') }}">
            {% elif 700 <= informations['Wettercode'][0] < 800 %} <img
              src="{{ url_for('static', filename='img/weather/foog.svg') }}">
            {% elif informations['Wettercode'][0] == 800 %}
              <img src="{{ url_for('static', filename='img/weather/sun.svg') }}">
            {% elif informations['Wettercode'][0] > 800 %}
              <img src="{{ url_for('static', filename='img/weather/cloud.svg') }}">
            {% else %}
              <img src="{{ url_for('static', filename='img/weather/sun.svg') }}">
            {% endif %}
          </div>
          <div class="p-3">
            <h5>{{ informations['Tag'][0] }}</h5>
            <p></p>
            <h6><b>{{ cityname }}</b></h6>
            <span>{{ informations['Wetter'][0] }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<div class="row">
  <div class="col-12 col-lg-6 d-flex align-items-stretch">
    <div class="card">
      <div class="card-header">CO2-Ersparnis</div>
      <div class="card-body">
        <p>Durch die PV-Anlage wurden bereits <b>{{saved_co2}} kg CO2</b> eingespart.</p>
      </div>
      <div class="chart-container">
        <canvas id="co2_saved" style="margin: 0 auto;" width="400" height="220"></canvas>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6 d-flex align-items-stretch">
    <div class="card">
      <div class="card-header">Erwartete PV-Energie</div>
      <div class="card-body">
        <p class="card-text">In den kommenden <b>14 Tagen</b> wird folgende erzeugte <b>Solarenergie</b> erwartet:</p>
        <p></p>
        <div class="chart-container">
          <canvas id="pv_prediction" style="margin: 0 auto;" width="350" height="220"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  var ctx1 = document.getElementById('pv_prediction').getContext('2d');
  var pv_prediction = {{ pv_prediction }};
  var pv_prediction_labels = {{ pv_prediction_labels | safe }};

  var netzbezug_chart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: pv_prediction_labels,
      datasets: [{
        label: 'PV-Erzeugung',
        data: pv_prediction,
        borderColor: 'rgb(300 180 50/ 80%)',
        backgroundColor: 'rgb(300 180 50/ 80%)',
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      animation: {
        duration: 2000
      },
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          callbacks: {
            afterLabel: function (context) {
              return 'kWh';
            }
          }
        }
      },
      scales: {
        y: {
          title: {
            display: true,
            text: 'kWh'
          }
        }
      }
    }
  });
</script>

<script>
  var ctx1 = document.getElementById('co2_saved').getContext('2d');
  var parsed = JSON.parse('{{termin_daten | tojson}}');
  var co2_saved_list = []
  for (const [key, value] of Object.entries(parsed)) {
    co2_saved_list.push(parsed[key]['saved_co2'])
  }
  var co2_saved_labels = []
  for (const [key, value] of Object.entries(parsed)) {
    var temp_date = parsed[key]['weekday'].toString() + ', ' + parsed[key]['date'].toString()
    co2_saved_labels.push(temp_date)
  }

  var netzbezug_chart = new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: co2_saved_labels,
      datasets: [{
        label: 'CO2-Einsparung',
        data: co2_saved_list,
        backgroundColor: 'rgb(20 200 60/ 80%)'
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      animation: {
        duration: 2000
      },
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          callbacks: {
            afterLabel: function (context) {
              return 'kg';
            }
          }
        }
      },
      scales: {
        y: {
          title: {
            display: true,
            text: 'kg'
          }
        }
      }
    }
  });
</script>



{% endblock %}