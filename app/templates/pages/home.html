{% extends 'base.html' %}
{% block content %}
<div class="row">

  <div class="col-12 col-lg-4 d-flex align-items-stretch">
    <div class="card">
      <div class="card-header">
        Energiebasierte Terminplanung
      </div>
      <div class="card-body">
        <h4>Herzlichen Willkommen, {{username}}! Schön, dass du da bist.</h4>
        <p>Hier steht eine Text, welcher kurz und knackig die Funktionalitäten des Systems beschreibt.</p>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-3 align-items-stretch">
    <div class="card">
      <div class="card-header">Wettervorhersage</div>
      <div class="card-body">
              <div class="col-12 col-lg-3 d-flex flex-row align-items-center">
                <div class="p-3">
                  <h4>{{ informations['Temp'][0] }}&deg;</h4>
                  {% if 200 <= informations['Wettercode'][0] < 300 %}
                  <img src="{{ url_for('static', filename='img/weather/storm.svg') }}">
                  {% elif 300 <= informations['Wettercode'][0] < 400 %}
                  <img src="{{ url_for('static', filename='img/weather/rainy.svg') }}">
                  {% elif informations['Wettercode'][0] == 500 %}
                  <img src="{{ url_for('static', filename='img/weather/light_rain.svg') }}">
                  {% elif 501 <= informations['Wettercode'][0] < 600 %}
                  <img src="{{ url_for('static', filename='img/weather/rainy.svg') }}">
                  {% elif informations['Wettercode'][0] == 616 %}
                  <img src="{{ url_for('static', filename='img/weather/snow_and_rain.svg') }}">
                  {% elif 600 <= informations['Wettercode'][0] < 700 %}
                  <img src="{{ url_for('static', filename='img/weather/snowflake.svg') }}">
                  {% elif 700 <= informations['Wettercode'][0] < 800 %}
                  <img src="{{ url_for('static', filename='img/weather/foog.svg') }}">
                  {% elif informations['Wettercode'][0] == 800 %}
                  <img src="{{ url_for('static', filename='img/weather/sun.svg') }}">
                  {% elif informations['Wettercode'][0] > 800 %}
                  <img src="{{ url_for('static', filename='img/weather/cloud.svg') }}">
                  {% else %}
                  <img src="{{ url_for('static', filename='img/weather/sun.svg') }}">
                  {% endif %}
                </div>
                <div class="p-3">
                  <h5>{{ informations['Tag'][0] }}</h5>
                  <p></p>
                  <h6><b>{{ cityname }}</b></h6>
                  <span>{{ informations['Wetter'][0] }}</span>
                </div>
              </div>    
      </div>
    </div>
    <div class="card">
      <div class="card-header">Dummy</div>
      <div class="card-body">
              <div class="col-12 col-lg-12 flex-row align-items-center">
                <p>Herzlich Willkommen, <b>{{username}}</b>!</p>
                <p>Hier befindet sich ein Platzhalter für eine Kachel.</p>
                
              </div>    
      </div>
    </div>
  </div>

  

  <div class="col-12 col-lg-4 d-flex align-items-stretch">
    <div class="card">
      <div class="card-header">Erwartete PV-Energie</div>
      <div class="card-body">
        <p class="card-text">In den kommenden <b>14 Tagen</b> wird folgende erzeugte <b>Solarenergie</b> erwartet:</p>
        <p></p>
        <div class="chart-container">
          <canvas id="pv_prediction" style="margin: 0 auto;" width="350" height="220"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="row">
  
  <div class="col-12 col-lg-6 d-flex align-items-stretch">
    <div class="card">
      <div class="card-header">Geplante Termine</div>
      <div class="card-body">
        <p>Insgesamt wurden bereits <b>{{ termin_daten|count }}</b> Termine mit dem EnOp-System optimiert.</p>
        <table class="table">
          <thead>
          <tr>
              <th scope="col">Datum & Uhrzeit</th>
              <th scope="col">Maschinen</th>
              <th scope="col">Mitarbeiter</th>
            </tr>
          </thead>
          <tbody>
            {% for item in termin_daten %}
            <tr>
              <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['weekday'] }}, {{ termin_daten[item]['date'] }} {{ termin_daten[item]['starttime'] }}-{{ termin_daten[item]['endtime'] }} </td>
              <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['machines'] }}</td>
              <td style="width: 1px; white-space: nowrap;">{{ termin_daten[item]['employees'] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script>
  var ctx1 = document.getElementById('pv_prediction').getContext('2d');  
  var pv_prediction = {{ pv_prediction }};
  var pv_prediction_labels = {{ pv_prediction_labels | safe }};

  var netzbezug_chart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: pv_prediction_labels,
      datasets: [{
        label: 'PV-Erzeugung',
        data: pv_prediction
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      animation: {
        duration: 2000
      },
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          callbacks: {
            afterLabel: function (context) {
              return 'kWh';
            }
          }
        }
      }
    }
  });
</script>

<script>
  var ctx1 = document.getElementById('historic_termine').getContext('2d');  
  var pv_prediction = {{ pv_prediction }};
  var pv_prediction_labels = {{ pv_prediction_labels | safe }};

  var netzbezug_chart = new Chart(ctx1, {
    type: 'line',
    data: {
      labels: pv_prediction_labels,
      datasets: [{
        label: 'PV-Erzeugung',
        data: pv_prediction
      }]
    },
    options: {
      responsive: false,
      maintainAspectRatio: false,
      legend: {
        display: false
      },
      animation: {
        duration: 2000
      },
      plugins: {
        legend: {
          display: false,
        },
        tooltip: {
          callbacks: {
            afterLabel: function (context) {
              return 'kWh';
            }
          }
        }
      }
    }
  });
</script>



{% endblock %}